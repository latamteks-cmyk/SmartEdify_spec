<div align="center">
  <img src="../branding/Logo_smartedify.jpg" width="200" height="200" alt="Logo SmartEdify" />
  <p><em>Gesti√≥n integral de condominios</em></p>
</div>

---
# üìò Documento de Visi√≥n ‚Äî SmartEdify

**Versi√≥n:** 0  
**Fecha:** 2025-10-08  
**Estado:** Aprobado  
**Autor:** Equipo de Producto y Arquitectura SmartEdify  
**Revisi√≥n:** CTO / Software Architect / Product Manager  

---

## üß≠ 1. Visi√≥n General

SmartEdify es una plataforma SaaS multi-tenant dise√±ada para la gesti√≥n integral de comunidades y condominios, con enfoque mobile-first, Zero Trust, cumplimiento normativo transnacional y observabilidad end-to-end.
Su prop√≥sito es **transformar la gobernanza, administraci√≥n, seguridad y prestaci√≥n de servicios comunes en entornos residenciales y comerciales mediante una soluci√≥n digital unificada, segura y escalable.**
La visi√≥n estrat√©gica se centra en convertir a SmartEdify en el sistema operativo digital para comunidades, garantizando:
Transparencia operativa con trazabilidad inmutable (logs WORM, firma electr√≥nica y actas con respaldo jur√≠dico).
Cumplimiento legal adaptativo mediante un 'Compliance-Service' que valida en tiempo real regulaciones locales e internacionales (GDPR, LGPD, eIDAS, SUNAT, etc.).
Participaci√≥n comunitaria inteligente, con asambleas digitales h√≠bridas, votaciones seguras y reservas automatizadas.
Experiencia de usuario unificada para propietarios, administradores, trabajadores y auditores, accesible por web y m√≥vil.
Cada tenant puede administrar m√∫ltiples condominios, con reglas de cumplimiento y pol√≠ticas jur√≠dicas independientes.
La arquitectura se basa en microservicios modulares bajo principios de Clean Architecture, API-First y Privacy by Design, priorizando resiliencia, seguridad criptogr√°fica (WebAuthn, DPoP, ES256/EdDSA), eficiencia en costos y despliegue multi-regi√≥n.
SmartEdify no solo digitaliza la gesti√≥n condominial, sino que redefine la gobernanza comunitaria con est√°ndares de seguridad, legalidad y usabilidad comparables a las infraestructuras cr√≠ticas modernas.
En su madurez plena, cada acci√≥n dentro de SmartEdify ser√° auditable, legalmente defendible y medible en t√©rminos de confianza, eficiencia y cumplimiento.

---

## üèóÔ∏è 2. Arquitectura Global del Sistema

```mermaid



%% SmartEdify ‚Äî Arquitectura Global del Sistema (mmd)
%% Layout recomendado: elk
%% Nota: Identity-QR (COSE/JWS, TTL corto, firmado) vs Asset-QR (no cifrado, identificaci√≥n de activos/√°reas)

---
config:
  layout: elk
---

flowchart TB

%% ========= Frontends =========
subgraph FE["Frontend Applications (Mobile-First)"]
  WA["Web Admin :4000"]
  WU["Web User :3000"]
  MA["Mobile App :8081"]
end

%% ========= BFF =========
subgraph BFF["BFF Layer"]
  BFF_A["BFF Admin :4001"]
  BFF_U["BFF User :3007"]
  BFF_M["BFF Mobile :8082"]
end

%% ========= Edge/Gateway =========
subgraph EDGE["Edge Security"]
  WAF["WAF / DDoS Shield"]
end
subgraph GWY["API Gateway :8080"]
  GW["Gateway Service + PEP (DPoP/JWT/JWKS Cache)"]
end

%% ========= Core =========
subgraph CORE["Core Services"]
  IS["Identity Service :3001\nOIDC/OAuth2.1 ‚Ä¢ WebAuthn ‚Ä¢ DPoP\nIssuer: https://auth.smartedify.global/{tenant_id}"]
  UPS["User Profiles Service :3002\nAtributos ‚Ä¢ Grupos ‚Ä¢ Cargos oficiales"]
  TS["Tenancy Service :3003\nTenants ‚Ä¢ Condominiums ‚Ä¢ Jurisdicciones"]
  NS["Notifications Service :3005\nEmail/SMS/Push ‚Ä¢ Plantillas"]
  DS["Documents Service :3006\nPDF ‚Ä¢ WORM ‚Ä¢ Firma electr√≥nica (cuando aplica)"]
end

%% ========= Governance =========
subgraph GOV["Governance Services"]
  GS["Governance Service :3011\nConvocatorias ‚Ä¢ Qu√≥rum ‚Ä¢ Votos ‚Ä¢ Actas"]
  CS["Compliance Service :3012\nModo Consulta (runtime) ‚Ä¢ Boletines (updates)"]
  RS["Reservation Service :3013\nEspacios ‚Ä¢ Reglas ‚Ä¢ Tarifas efectivas"]
  SS["Streaming Service :3014\nAsambleas h√≠bridas ‚Ä¢ Presencia/Marcas de tiempo"]
end

%% ========= Operations =========
subgraph OPS["Operations Services"]
  AMS["Asset Mgmt Service :3010\nActivos ‚Ä¢ Incidencias ‚Ä¢ OT ‚Ä¢ Asset-QR (no cifrado)"]
  FS["Finance Service :3007\nGL ‚Ä¢ AR/AP ‚Ä¢ FX ‚Ä¢ NIC + Fiscal"]
  PS["Payroll Service :3008\nC√°lculo ‚Ä¢ Payslips ‚Ä¢ Exportes regulatorios"]
  HCS["HR Compliance Service :3009\nReglas laborales por pa√≠s ‚Ä¢ Elegibilidad"]
  PSS["Physical Security (Futuro) :3004\nACS ‚Ä¢ Visi√≥n por computador"]
end

%% ========= Business =========
subgraph BUS["Business Services"]
  MS["Marketplace Service :3015\nProveedores ‚Ä¢ Pagos integrados"]
  AS["Analytics Service :3016\nKPIs ‚Ä¢ Dashboards ‚Ä¢ Anonimizaci√≥n"]
end

%% ========= Platform / Data / Obs =========
subgraph PLT["Platform Layer"]
  subgraph MSG["Messaging & Streaming"]
    KAFKA["Apache Kafka :9092"]
    SR["Schema Registry"]
    KC["Kafka Connect / CDC"]
    DLQ["Dead Letter Queue"]
    REDIS["Redis (Regional) :6379\nJWKS ‚Ä¢ DPoP-Nonce ‚Ä¢ Antireplay ‚Ä¢ Caches pol√≠ticas"]
  end
  subgraph DATA["Storage & Crypto"]
    PG[("PostgreSQL :5432\nRLS {tenant, condominium}")]
    S3[("S3 Object Storage")]
    WORM[("S3 Object Lock / WORM\nHash-chain / Evidencias")]
    KMS[("KMS / HSM\nRotaci√≥n 90d + Rollover 7d")]
    SEC[("Secrets Manager")]
  end
  subgraph POLI["Policy Distribution"]
    POL["Policy CDN (OPA bundles firmados)"]
  end
  subgraph OBS["Observability"]
    OTEL["OTel Collector :4317"]
    TRC["Tracing Backend (Tempo/Jaeger)"]
    LOGS["Logs Backend (OpenSearch/ELK)"]
    PROM["Prometheus :9090"]
    GRAF["Grafana :3000"]
  end
end

%% ========= Wiring: Front ‚Üí BFF ‚Üí WAF/GW =========
WA --> BFF_A --> WAF --> GW
WU --> BFF_U --> WAF
MA --> BFF_M --> WAF
WAF --> GW

%% ========= Gateway ‚Üí Microservicios =========
GW --> IS & UPS & TS & NS & DS & GS & CS & RS & SS & AMS & FS & PS & HCS & MS & AS

%% ========= Core/Data/Messaging Links =========
IS --> PG
IS --> REDIS
IS -.-> KAFKA
IS -.-> OTEL
IS --- KMS
IS --- POL

UPS --> PG
TS --> PG
GS --> PG
FS --> PG
RS --> PG
AMS --> PG

DS --> S3
DS --- WORM

KAFKA --- SR
KAFKA --- DLQ
KC -.-> KAFKA
TS -.-> KC

OTEL --- TRC
OTEL --- LOGS
PROM --- GRAF

GW -.-> PROM
GW --- SEC

%% ========= Governance / Compliance Dynamics =========
CS -. "Boletines: RoleUpdate / TariffSchedule / EligibilityRule" .-> KAFKA
KAFKA -.-> GS
KAFKA -.-> RS
KAFKA -.-> FS
KAFKA -.-> HCS
KAFKA -.-> AMS

%% ========= Identity-QR vs Asset-QR =========
GS -. "Solicita Identity-QR (COSE/JWS, TTL‚â§300s, kid)" .-> IS
AMS -. "Escanea Asset-QR (no cifrado)" .-> AMS

%% ========= Classes =========
classDef frontend fill:#e1f5fe,stroke:#01579b,color:#000
classDef bff fill:#f3e5f5,stroke:#4a148c,color:#000
classDef edge fill:#fff8e1,stroke:#ef6c00,color:#000
classDef gateway fill:#e8f5e8,stroke:#1b5e20,color:#000
classDef core fill:#fff3e0,stroke:#e65100,color:#000
classDef governance fill:#fce4ec,stroke:#880e4f,color:#000
classDef operations fill:#f1f8e9,stroke:#33691e,color:#000
classDef business fill:#e0f2f1,stroke:#004d40,color:#000
classDef platform fill:#f5f5f5,stroke:#424242,color:#000

class WA,WU,MA frontend
class BFF_A,BFF_U,BFF_M bff
class WAF edge
class GW gateway
class IS,UPS,TS,NS,DS core
class GS,CS,RS,SS governance
class AMS,FS,PS,HCS,PSS operations
class MS,AS business
class KAFKA,SR,KC,DLQ,REDIS,PG,S3,WORM,KMS,SEC,POL,OTEL,TRC,LOGS,PROM,GRAF platform



```

---

## üë• 3. Usuarios y Personas

| Rol | Descripci√≥n | Acceso principal |
|-----|--------------|------------------|
| Propietario | Miembro de asamblea con derechos de voto | App m√≥vil / Web User |
| Administrador | Representante legal del condominio | Web Admin |
| Trabajador / Proveedor | Ejecuta servicios o tareas | App m√≥vil |
| Auditor / Legal | Supervisa cumplimiento normativo | Web Admin |
| Sistema externo | Consume APIs autorizadas | OAuth2.1 + mTLS |

---

## üì¶ 4. Microservicios y Alcance Funcional

### 4.1. Identity Service (3001)
Proveedor central de identidad, autenticaci√≥n y sesiones con cumplimiento normativo y soporte biom√©trico.  
Incluye autenticaci√≥n WebAuthn, DPoP, MFA adaptativo y generaci√≥n de QR seguros para asambleas.

### 4.2. User Profiles (3002)
Gesti√≥n de atributos, roles, relaciones jer√°rquicas y asociaciones con tenants y unidades residenciales.

### 4.3. Tenancy Service (3003)
Define condominios, unidades, espacios y relaci√≥n entre tenants y jurisdicciones legales.  
Soporta residencia por pa√≠s y RLS criptogr√°fico.

### 4.4. Governance Service (3011)
Gesti√≥n de asambleas, actas, qu√≥rum, votaciones, mandatos y resoluciones con respaldo jur√≠dico.  
Integrado con Compliance para validaci√≥n legal en tiempo de ejecuci√≥n.

### 4.5. Compliance Service (3012)
Valida pol√≠ticas legales, roles vigentes y par√°metros normativos.  
Opera en dos modos: **consulta bajo demanda** y **emisi√≥n de boletines de actualizaci√≥n** (ej. nombramientos o tarifas).

### 4.6. Reservations Service (3013)
Gesti√≥n de reservas de espacios comunes, calendario compartido y cobro automatizado seg√∫n reglas del Governance Service.

### 4.7. Asset Management Service (3010)
Gesti√≥n de activos, incidencias, mantenimiento y trazabilidad mediante QR no encriptados.  
Permite asociar inspecciones y √≥rdenes de trabajo a ubicaciones f√≠sicas.

### 4.8. Finance Service (3007)
Contabilidad, flujo de caja, tarifas, cuotas, conciliaciones y reportes fiscales bajo est√°ndares NIC y normativa nacional.

### 4.9. Payroll Service (3008)
Gesti√≥n de n√≥minas, beneficios y obligaciones laborales. Genera recibos de pago y se integra con APIs fiscales (SUNAT, IVSS, etc.).

### 4.10. HR Compliance Service (3009)
Validaci√≥n de cumplimiento laboral, contratos y normativas por pa√≠s. Monitoreo continuo de obligaciones legales del empleador.

### 4.11. Notifications Service (3005)
Orquestador de notificaciones push, correo y mensajer√≠a interna por tenant.

### 4.12. Documents Service (3006)
Gesti√≥n documental con firma electr√≥nica, versionado, cifrado y almacenamiento WORM.  
Firma v√°lida solo en documentos con requerimientos legales.

### 4.13. Streaming Service (3014)
Transmisi√≥n en vivo de asambleas h√≠bridas con registro legal de participaci√≥n y timestamp certificado.

---

## ‚öôÔ∏è 5. Flujos Principales

### CU-01 ‚Äî Registro y Activaci√≥n Delegada
1. Administrador registra usuario en User Profiles.  
2. Se env√≠a enlace de activaci√≥n v√≠a Notifications.  
3. Identity valida y completa el registro.  
4. Compliance audita consentimiento.

### CU-02 ‚Äî Autenticaci√≥n Segura
1. Usuario inicia sesi√≥n (WebAuthn o Passkey).  
2. Identity genera JWT + DPoP.  
3. Sesi√≥n v√°lida 10 min, asociada al dispositivo.

### CU-03 ‚Äî Asamblea Digital
1. Governance crea evento con roles firmantes.  
2. Identity genera QR firmado para acceso.  
3. Compliance valida legalidad.  
4. Streaming registra asistencia y votos.

---

## üõ°Ô∏è 6. Seguridad y Cumplimiento

| Mecanismo | Descripci√≥n |
|------------|-------------|
| TLS 1.3 + mTLS | Canal seguro interservicios. |
| AES-256 at rest | Cifrado en base de datos y backups. |
| DPoP obligatorio | Prevenci√≥n de replay attacks. |
| JWKS rotaci√≥n 90d | Claves firmantes actualizadas peri√≥dicamente. |
| Logs WORM | Evidencia inmutable de auditor√≠a. |
| GDPR / LGPD / eIDAS | Cumplimiento normativo multinacional. |

---

## üìä 7. M√©tricas Clave

| Indicador | Objetivo |
|------------|----------|
| Disponibilidad global | ‚â• 99.95% |
| Latencia autenticaci√≥n | ‚â§ 3 s (P95) |
| Tiempo revocaci√≥n sesi√≥n | ‚â§ 30 s |
| Cumplimiento auditor√≠as | 100% |
| Adopci√≥n WebAuthn | ‚â• 80% |

---

## üóìÔ∏è 8. Roadmap Estrat√©gico

```mermaid
gantt
    title Roadmap de Implementaci√≥n SmartEdify
    dateFormat YYYY-MM-DD
    section Fase 1: Fundacional
    Identity / Profiles / Tenancy  :done, 2025-01-01, 2025-03-31
    section Fase 2: Gobernanza y Cumplimiento
    Governance / Compliance / Documents :active, 2025-04-01, 2025-07-31
    section Fase 3: Operaciones
    Finance / Payroll / Asset Mgmt :2025-08-01, 2025-11-30
    section Fase 4: Expansi√≥n
    Marketplace / Analytics / Streaming :2025-12-01, 2026-03-31
```

---

## üß© 9. Relaci√≥n entre Microservicios y Dominios

| Dominio | Servicios Asociados |
|----------|--------------------|
| Core | Identity, User Profiles, Tenancy, Notifications, Documents |
| Governance | Governance, Compliance, Reservations, Streaming |
| Operations | Asset Management, Finance, Payroll, HR Compliance |
| Business | Marketplace, Analytics |
| Platform | Kafka, PostgreSQL, Redis, Prometheus, Grafana, S3 |

---

## üßæ 10. Historial de Cambios

| Versi√≥n | Fecha | Descripci√≥n |
|----------|--------|-------------|
| 1.0 | 2025-08-01 | Versi√≥n inicial del documento de visi√≥n. |
| 1.1 | 2025-10-08 | Versi√≥n revisada, ampliada y actualizada seg√∫n arquitectura integral. |

