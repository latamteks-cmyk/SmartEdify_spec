### 📄 F-06_Propagacion_Contexto
```mermaid
sequenceDiagram
    participant Cliente as Cliente (Web/Mobile)
    participant BFF as BFF Layer
    participant GW as API Gateway
    participant TS as Tenancy Service
    participant UPS as User Profiles Service
    participant Redis as Context Cache
    participant OTel as OTel Collector
    participant Grafana as Dashboard

    Cliente->>BFF: Solicita recurso sensible (ej. reserva, firma)
    BFF->>GW: Envia solicitud con headers de contexto
    GW->>TS: Consulta `tenant_id`, `condominium_id`
    TS->>UPS: Verifica membresía y rol del usuario
    UPS->>Redis: Cachea contexto organizacional
    Redis-->>UPS: TTL 10 min
    UPS-->>GW: Contexto validado
    GW->>OTel: Envia atributos de contexto (`user_role`, `tenant_id`, `condominium_id`)
    OTel->>Grafana: Actualiza métricas y dashboards
    Grafana-->>Admin: Visualización por tenant
```
# Artefactos Técnicos — F-06: Propagación de Contexto y Observabilidad por Tenant

## 🧩 Endpoints OpenAPI
- `GET /profiles/{user}/memberships`
- Headers propagados: `x-tenant-id`, `x-condominium-id`, `x-user-role`

## 📊 Métricas y Observabilidad
- `policy_version_skew > 1`
- `pdp_latency_p95`
- `context_cache_hit_rate`
- Dashboards por tenant en Grafana

## 📦 Cache Layer
- Redis regional
- TTL: 10 minutos
- Invalidación por `session_refresh` o `event-driven`

## 📁 OpenTelemetry
- Semantic Conventions aplicadas
- Atributos enriquecidos: `tenant_id`, `condominium_id`, `user_role`
- Exportación a Prometheus + Grafana

## ✅ Convenciones Aplicadas
- Observabilidad por tenant (PDR-6)
- Clean Architecture (PDR-2)
- RLS por `tenant_id` y `condominium_id`
- SLO monitoring (SAD §11.1)
