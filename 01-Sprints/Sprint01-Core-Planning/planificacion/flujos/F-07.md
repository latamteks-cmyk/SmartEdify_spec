### ğŸ“„ F-07_Consentimiento_DSAR
```mermaid
sequenceDiagram
    participant Usuario as Usuario Final
    participant App as AplicaciÃ³n Web/MÃ³vil
    participant GW as API Gateway
    participant UPS as User Profiles Service
    participant CS as Compliance Service
    participant IS as Identity Service
    participant Kafka as Kafka Broker
    participant WORM as WORM Logs

    Usuario->>App: Solicita acceso o eliminaciÃ³n de datos (DSAR)
    App->>GW: POST /dsar/request
    GW->>UPS: Verifica existencia de consentimiento registrado
    UPS->>CS: Valida polÃ­tica vigente y jurisdicciÃ³n
    CS-->>UPS: Resultado de validaciÃ³n legal
    UPS->>Kafka: Emite evento ConsentRevoked.v1
    Kafka-->>UPS: Confirma publicaciÃ³n
    UPS->>WORM: Registra revocaciÃ³n en logs inmutables
    UPS-->>GW: Resultado de operaciÃ³n
    GW-->>App: ConfirmaciÃ³n al usuario
```
# Artefactos TÃ©cnicos â€” F-07: GestiÃ³n de Consentimiento y DSAR

## ğŸ§© Endpoints OpenAPI
- `POST /dsar/request` â†’ Solicitud de acceso o eliminaciÃ³n de datos personales
- `GET /profiles/{user}/consents` â†’ Consulta de consentimientos registrados

## ğŸ“¦ Evento Kafka
- `ConsentRevoked.v1`
  - Payload: `{ user_id, tenant_id, timestamp, reason, policy_version }`
  - Topic: `privacy.consent`
  - Schema: registrado en Schema Registry

## ğŸ“ Registro Legal
- WORM + hash-chain
- Registro de revocaciÃ³n con metadatos legales
- Trazabilidad completa para auditorÃ­a

## ğŸ” Seguridad y Privacidad
- ValidaciÃ³n de polÃ­ticas por jurisdicciÃ³n (GDPR Art. 7, LGPD Art. 8)
- TTL corto en cache de polÃ­ticas (5 min)
- Cifrado de PII por tenant (KMS/HSM)
- No se almacenan datos sensibles en eventos

## ğŸ“Š MÃ©tricas
- `dsar_response_time â‰¤ 72h`
- `consent_revocation_latency_p95`
- `consent_revoked_total`

## âœ… Convenciones Aplicadas
- Privacy by Design (PDR-4)
- Cifrado de PII (SAD Â§6.2)
- Event-driven architecture
- WORM compliance
