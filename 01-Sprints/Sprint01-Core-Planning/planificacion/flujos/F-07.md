### 📄 F-07_Consentimiento_DSAR
```mermaid
sequenceDiagram
    participant Usuario as Usuario Final
    participant App as Aplicación Web/Móvil
    participant GW as API Gateway
    participant UPS as User Profiles Service
    participant CS as Compliance Service
    participant IS as Identity Service
    participant Kafka as Kafka Broker
    participant WORM as WORM Logs

    Usuario->>App: Solicita acceso o eliminación de datos (DSAR)
    App->>GW: POST /dsar/request
    GW->>UPS: Verifica existencia de consentimiento registrado
    UPS->>CS: Valida política vigente y jurisdicción
    CS-->>UPS: Resultado de validación legal
    UPS->>Kafka: Emite evento ConsentRevoked.v1
    Kafka-->>UPS: Confirma publicación
    UPS->>WORM: Registra revocación en logs inmutables
    UPS-->>GW: Resultado de operación
    GW-->>App: Confirmación al usuario
```
# Artefactos Técnicos — F-07: Gestión de Consentimiento y DSAR

## 🧩 Endpoints OpenAPI
- `POST /dsar/request` → Solicitud de acceso o eliminación de datos personales
- `GET /profiles/{user}/consents` → Consulta de consentimientos registrados

## 📦 Evento Kafka
- `ConsentRevoked.v1`
  - Payload: `{ user_id, tenant_id, timestamp, reason, policy_version }`
  - Topic: `privacy.consent`
  - Schema: registrado en Schema Registry

## 📁 Registro Legal
- WORM + hash-chain
- Registro de revocación con metadatos legales
- Trazabilidad completa para auditoría

## 🔐 Seguridad y Privacidad
- Validación de políticas por jurisdicción (GDPR Art. 7, LGPD Art. 8)
- TTL corto en cache de políticas (5 min)
- Cifrado de PII por tenant (KMS/HSM)
- No se almacenan datos sensibles en eventos

## 📊 Métricas
- `dsar_response_time ≤ 72h`
- `consent_revocation_latency_p95`
- `consent_revoked_total`

## ✅ Convenciones Aplicadas
- Privacy by Design (PDR-4)
- Cifrado de PII (SAD §6.2)
- Event-driven architecture
- WORM compliance
