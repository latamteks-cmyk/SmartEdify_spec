### ðŸ“„ F-04: ValidaciÃ³n de MembresÃ­a y Contexto

```mermaid
sequenceDiagram
    participant Cliente as Cliente (Web/Mobile)
    participant BFF as BFF Layer
    participant GW as API Gateway
    participant UPS as User Profiles Service
    participant TS as Tenancy Service
    participant CS as Compliance Service
    participant Redis as Context Cache

    Cliente->>BFF: Solicita acceso a recurso (ej. reserva, firma)
    BFF->>GW: GET /profiles/{user}/memberships
    GW->>UPS: Consulta membresÃ­as del usuario
    UPS->>TS: Verifica unidad, condominio, tenant
    TS->>TS: Aplica RLS por tenant_id y condominium_id
    TS-->>UPS: Resultado de validaciÃ³n jerÃ¡rquica
    UPS->>CS: Valida polÃ­ticas de contexto organizacional
    CS->>Redis: Consulta cache de polÃ­ticas activas
    Redis-->>CS: PolÃ­ticas vigentes
    CS-->>UPS: Resultado de validaciÃ³n legal
    UPS-->>GW: Contexto vÃ¡lido (o error)
    GW-->>BFF: Respuesta con contexto organizacional
    BFF-->>Cliente: Acceso autorizado (o denegado)
```
### ðŸ§© Artefactos tÃ©cnicos vinculados

**OpenAPI endpoint:** GET /profiles/{user}/memberships
**Modelo de datos:** relaciÃ³n user â†” unit â†” condominium â†” tenant
**MÃ©trica clave:** pdp_latency_p95
**Convenciones aplicadas:**
- PBAC con OPA (SAD Â§6.1)
- RLS por tenant_id y condominium_id
- Clean Architecture (PDR-2)
- Privacy by Design (PDR-4)
