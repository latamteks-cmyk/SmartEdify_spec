# ⚠️ Matriz de Riesgos: Fase 1 - Core Backbone

Este documento identifica los riesgos más significativos para la planificación y ejecución de la Fase 1 (Core Backbone) y establece las estrategias de mitigación correspondientes.

---

| ID | Riesgo | Impacto | Probabilidad | Nivel de Riesgo | Estrategia de Mitigación |
|----|--------|---------|--------------|-----------------|--------------------------|
| **R-01** | **Complejidad de la Multi-Región y Residencia de Datos** | Crítico | Media | **Alto** | - **Finalizar y aprobar `ADR-026` y `ADR-027`** sobre política declarativa de residencia y sincronización multi-región.<br>- Implementar políticas de residencia de datos en la capa de Infraestructura como Código (Terraform) desde el inicio.<br>- Ejecutar de forma rigurosa los **escenarios de Chaos Engineering** definidos en el SAD del Tenancy Service (fallo de región, latencia, partición de red). |
| **R-02** | **Implementación Incorrecta de Primitivas de Seguridad** | Crítico | Media | **Alto** | - **Revisiones de Código Obligatorias (Peer Review)** por el Security Lead para todo el código relacionado con autenticación y criptografía.<br>- Utilizar bibliotecas estándar y auditadas para la implementación de WebAuthn, DPoP y COSE/JWS.<br>- Desarrollar un **conjunto de pruebas de integración específico para seguridad** que valide flujos de ataque comunes (replay, spoofing, etc.).<br>- **Agendar pruebas de penetración** con un tercero especializado al finalizar la Fase 1. |
| **R-03** | **Cuello de Botella en el `compliance-service` (PDP)** | Alto | Media | **Alto** | - Implementar la **estrategia de caché multi-capa** (local en memoria + Redis regional) para las políticas de OPA, como se define en las especificaciones.<br>- Definir y monitorear **SLOs estrictos** para el endpoint `/evaluate` desde el primer despliegue.<br>- Realizar **pruebas de carga enfocadas** en la interacción `user-profiles` ↔ `compliance-service` para identificar límites. |
| **R-04** | **Dependencia Crítica en Servicios Core** | Alto | Alta | **Alto** | - Implementar de forma prioritaria los patrones de resiliencia definidos: **Circuit Breakers, Timeouts y Reintentos con Backoff Exponencial** para toda la comunicación inter-servicio.<br>- Validar el comportamiento de **`fail-closed`** del `compliance-service` mediante pruebas de caos específicas.<br>- Asegurar que los servicios core (`identity`, `tenancy`) tengan la **máxima prioridad en recursos** y configuraciones de alta disponibilidad. |
| **R-05** | **Gestión de Secretos y Claves (KMS/HSM)** | Crítico | Baja | **Medio** | - **Automatizar la rotación de claves** (JWKS, mTLS) a través de pipelines de DevSecOps desde el Sprint 2.<br>- Limitar el acceso a KMS/Secrets Manager utilizando el principio de mínimo privilegio en las políticas de IAM.<br>- Implementar **alertas automáticas** para la expiración de certificados y claves. |
| **R-06** | **Inconsistencia de Datos en Arquitectura Orientada a Eventos** | Alto | Media | **Medio** | - Implementar **patrones de mensajería fiables**: reintentos, DLQ (Dead Letter Queue) y monitoreo de `consumer lag` en Kafka.<br>- Utilizar el **patrón Outbox** para garantizar la entrega atómica de eventos junto con las transacciones de base de datos.<br>- Asegurar que todos los eventos críticos sean **idempotentes**. |
