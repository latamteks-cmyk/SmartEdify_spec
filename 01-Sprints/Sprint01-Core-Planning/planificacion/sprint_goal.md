# üéØ Sprint Goal: Sprint 01 - Core Planning

**Per√≠odo:** 2025-09-15 ‚Äì 2025-09-29

## 1. Objetivo Principal

Establecer las bases t√©cnicas, arquitect√≥nicas y operativas para construir un **Core Backbone production-ready**, alineado con los principios de **Zero Trust, Privacy by Design, Observabilidad y Cumplimiento Normativo**.  
Este sprint se enfoca exclusivamente en **planificaci√≥n, especificaci√≥n y dise√±o**, no en desarrollo de c√≥digo de producci√≥n.  
Al finalizar, el equipo contar√° con un **contrato t√©cnico ejecutable** que gu√≠e la implementaci√≥n en los sprints siguientes.

Al final de este sprint, el equipo tendr√° una comprensi√≥n inequ√≠voca del "qu√©", el "porqu√©" y el "c√≥mo" de los servicios que forman el n√∫cleo de nuestra plataforma.

## 2. Objetivos Clave (Key Objectives)

### ‚úÖ 2.1 Finalizar y Aprobar Especificaciones T√©cnicas de Alto Nivel  
- Revisar y alinear las especificaciones de los tres servicios con:
  - El [Documento de Visi√≥n](./00-Governance/vision_document.md)
  - El [Software Architecture Document](./00-Governance/software_architecture.md)
  - Los **ADR aprobados** (ADR-001 a ADR-017)
  - Las **acciones de hardening del CTO** (H-01 a H-07)
  - Asegurar que cada servicio defina expl√≠citamente:
  - Contratos de API (OpenAPI 3.1)
  - Modelo de datos (DBML con RLS)
  - M√©tricas RED y SLOs
  - Estrategia de observabilidad (OTel attributes)
  - Modo de degradaci√≥n y fallback

### ‚úÖ 2.2 Construir un Backlog T√©cnico y Funcional Priorizado  
- Desglosar las especificaciones en **historias de usuario funcionales** y **historias t√©cnicas transversales** (seguridad, observabilidad, resiliencia).
- Incluir expl√≠citamente las historias derivadas de las **acciones H-01 a H-07** del CTO Review.
- Priorizar para lograr un **MVP t√©cnicamente s√≥lido** en Sprint 2‚Äì4, con capacidad de pasar a **Release Candidate (RC)** tras el hardening.

### ‚úÖ 2.3 Definir la Estrategia de Calidad y Observabilidad desde el D√≠a 0  
- Establecer los **artefactos obligatorios de calidad** por servicio:
  - Plan de pruebas de caos (Compliance fail-closed, JWKS rotaci√≥n)
  - Suite de pruebas de interoperabilidad (JWKS externos, DPoP anti-replay)
  - Benchmarks de latencia WebAuthn por plataforma
  - Esquemas de eventos en Schema Registry (`AuthSuccess.v1`, `SessionRevoked.v1`)
- Definir el **dashboard m√≠nimo de m√©tricas** para RC (incluyendo `kid_mismatch_detected_total`, `compliance_fail_closed_trigger_count`, `webauthn_*_latency_p95`).

### ‚úÖ 2.4 Formalizar Roles, Responsabilidades y Flujo de Trabajo  
- Asignar responsables claros para:
  - Arquitectura y ADRs (Tech Lead / Software Architect)
  - Calidad y pruebas (QA Lead)
  - Seguridad y cumplimiento (Security Champion)
  - Observabilidad y SRE (DevEx / SRE Engineer)
- Definir el **flujo de validaci√≥n de cambios**: PR ‚Üí revisi√≥n de ADR ‚Üí CI con validaci√≥n de `kid`/JWKS ‚Üí merge.

### ‚úÖ 2.5 Identificar y Mitigar Riesgos T√©cnicos Cr√≠ticos  
- Documentar riesgos clave:
  - Complejidad del anti-replay DPoP
  - Disponibilidad del KMS en CI
  - Inconsistencia `kid` ‚Üî JWKS
  - Baja adopci√≥n de Passkey en m√≥viles
- Establecer mitigaciones concretas:
  - Mock KMS en CI (H-05)
  - TTL ‚â§60s en Redis regional (H-04)
  - Test autom√°tico en pipeline (H-06)
  - Pruebas de usabilidad real (H-06)

## 3. Definici√≥n de Hecho (Definition of Done)

El Sprint 01 se considerar√° completado **solo cuando todos los siguientes artefactos est√©n aprobados y disponibles en el repositorio del proyecto**:

- [x] `sprint_goal.md` (este documento) actualizado y aprobado por CTO y Product Manager.  
- [x] `backlog.md` actualizado con **historias funcionales y t√©cnicas**, priorizadas y vinculadas a las acciones H-01‚Ä¶H-07.  
- [x] `team_roles.md` definido con roles expl√≠citos (Tech Lead, Security Champion, QA Lead, etc.).  
- [x] `risk_matrix.md` con riesgos t√©cnicos y plan de mitigaci√≥n aprobado.  
- [x] Especificaciones t√©cnicas de los tres servicios (`identity`, `user-profiles`, `tenancy`) en estado **‚úÖ Aprobado** por el CTO.  
- [x] **Plantillas base** para los artefactos cr√≠ticos:
  - `ADR-template.md`
  - `openapi-template.yaml`
  - `dbml-model-template.dbml`
  - `chaos-test-plan-template.md`
  - `metrics-dashboard-spec.md`

> **Nota del CTO**:  
> Este sprint no entrega valor de usuario directo, pero **entrega la confianza t√©cnica necesaria** para construir una infraestructura cr√≠tica.  
> La calidad de la planificaci√≥n aqu√≠ determinar√° la velocidad, seguridad y cumplimiento de toda la Fase 1.
>
> ## 4. Checklist
>
> 
# ‚úÖ Checklist de Cierre ‚Äî Sprint 1 Backbone (SmartEdify)
**Fecha de generaci√≥n:** 2025-10-09 11:56:07  
**√Åmbito:** Identity (3001), User Profiles (3002), Tenancy (3003), Plataforma, BFF/Frontends, Documentaci√≥n y Operaciones.  
**Formato:** `Responsable ‚Äî [ ] Tarea` (todas las tareas son at√≥micas y verificables).

---

## 0. Gobierno del Sprint
- **PM/PO** ‚Äî [ ] Congelar alcance Sprint 1 y criterios de salida.
- **PM/PO** ‚Äî [ ] Publicar cronograma y hitos (staging, RC, producci√≥n).
- **PM/PO** ‚Äî [ ] Asignar responsables por servicio y aprobar carga.

---

## 1) Identity Service (3001)
- **Identity Lead** ‚Äî [ ] Implementar issuer por tenant: `https://auth.{region}.smartedify.global/t/{tenant_id}` (discovery por path).
- **Identity Lead** ‚Äî [ ] Exponer `/{tenant_id}/.well-known/openid-configuration` y `/{tenant_id}/.well-known/jwks.json`.
- **Identity Dev** ‚Äî [ ] Flujos OIDC: `/authorize`, `/oauth/par`, `/oauth/token`, `/oauth/introspect`, `/oauth/revoke`, `/userinfo`.
- **Identity Dev** ‚Äî [ ] Enforce PKCE en `authorization_code` y prohibir `implicit`/`hybrid`.
- **Identity Dev** ‚Äî [ ] DPoP: validar `htu|htm|jti|ath`, clock skew y anti-replay en Redis regional.
- **Identity Dev** ‚Äî [ ] WebAuthn: registro y autenticaci√≥n; AAL2/AAL3 con attestation cuando aplique.
- **Identity Dev** ‚Äî [ ] Fallback TOTP: enrolamiento y recuperaci√≥n solo con app certificada.
- **Identity Dev** ‚Äî [ ] Refresh tokens: rotaci√≥n + reuse-detection + `cnf.jkt` (sender-constrained).
- **Identity Dev** ‚Äî [ ] Logout global: `/logout` + `backchannel-logout` + `not-before` por `sub`.
- **Identity Dev** ‚Äî [ ] QR de identidad (COSE/JWS, TTL 300 s, `kid`): `POST /identity/v2/contextual-tokens` y `/validate`.
- **Identity SRE** ‚Äî [ ] JWKS: rotaci√≥n 90 d, rollover 7 d, cache TTL ‚â§ 5 min, background refresh.
- **Identity SRE** ‚Äî [ ] M√©tricas: `auth_latency_p95`, `token_validation_error_rate`, `revocation_latency_p95`.
- **QA** ‚Äî [ ] E2E: registro ‚Üí activaci√≥n ‚Üí login ‚Üí revocaci√≥n.
- **SecOps** ‚Äî [ ] Pentest de flujos OIDC/DPoP/WebAuthn y fuzzing de JWT.

---

## 2) User Profiles Service (3002)
- **Profiles Lead** ‚Äî [ ] CRUD de perfiles con verificaci√≥n de identidad (enlace con Identity).
- **Profiles Dev** ‚Äî [ ] Roles y delegaciones con expiraci√≥n/TTL y auditor√≠a de uso.
- **Profiles Dev** ‚Äî [ ] Relaci√≥n `profile ‚Üî unit ‚Üî condominium` con constraints y RLS.
- **Profiles Dev** ‚Äî [ ] Evaluador PBAC `/evaluate` con OPA bundles **firmados** (Ed25519/ES256).
- **Profiles Dev** ‚Äî [ ] Invalidation push de cache al cambiar roles/delegaciones.
- **Profiles Dev** ‚Äî [ ] DSAR proxy: export/borrado coordinado con Compliance/Documents.
- **Profiles SRE** ‚Äî [ ] M√©tricas: `pdp_latency_p95`, `pdp_cache_hit_rate`, `pdp_cache_invalidation_latency_p95`.
- **QA** ‚Äî [ ] Tests de idempotencia y conflictos de membres√≠a (RFC 7807).

---

## 3) Tenancy Service (3003)
- **Tenancy Lead** ‚Äî [ ] Modelo jer√°rquico `tenant ‚Üí condominium ‚Üí building ‚Üí unit ‚Üí space`.
- **Tenancy Dev** ‚Äî [ ] API CRUD (RFC 7807) + b√∫squedas por contexto.
- **Tenancy Dev** ‚Äî [ ] Metadatos: `data_residency`, `region_code`, `jurisdiction_id`.
- **Tenancy Dev** ‚Äî [ ] Eventos Kafka: `TenantCreated`, `JurisdictionChanged`, `UnitReassigned` (Schema Registry).
- **Tenancy DBA** ‚Äî [ ] RLS por `tenant_id`; √≠ndices y cardinalidades validadas.
- **Tenancy SRE** ‚Äî [ ] Fallback de lookups firmados (KMS) cuando el servicio no est√© disponible.
- **QA** ‚Äî [ ] Pruebas de consistencia jer√°rquica y reconciliaci√≥n cross-region.

---

## 4) Plataforma (Gateway, Cache, Mensajer√≠a, Observabilidad, Seguridad)
- **Platform Lead** ‚Äî [ ] Gateway (8080) con validaci√≥n JWT+DPoP, rate-limits por `tenant_id`/IP/ASN.
- **Platform Dev** ‚Äî [ ] Redis regional: espacios para JWKS cache, anti-replay DPoP, sesiones.
- **Platform Dev** ‚Äî [ ] Kafka + Schema Registry + DLQ + Retention policies.
- **Platform SRE** ‚Äî [ ] Prometheus/Grafana/OTel Collector; paneles base por servicio.
- **Platform SecOps** ‚Äî [ ] mTLS en malla (Istio), rotaci√≥n de certs 90 d.
- **Platform SecOps** ‚Äî [ ] Secrets Manager: rotaci√≥n autom√°tica, acceso por pol√≠tica m√≠nima.
- **Platform SRE** ‚Äî [ ] Backups autom√°ticos; RTO/RPO: Identity ‚â§5m/‚â§1m; Profiles/Tenancy ‚â§15m/‚â§5m.
- **Platform SRE** ‚Äî [ ] DRP y pruebas de restore verificadas.

---

## 5) BFFs y Frontend (Pista PMV)
- **BFF Lead** ‚Äî [ ] BFF Admin/User/Mobile: proxies autenticados, sin l√≥gica de negocio.
- **Web Admin** ‚Äî [ ] Login PKCE, gesti√≥n b√°sica de usuarios, invitaciones, selector tenant/condominio.
- **Web User** ‚Äî [ ] Login PKCE, activaci√≥n por invitaci√≥n, perfil y relaciones.
- **Mobile** ‚Äî [ ] Login PKCE + DPoP, lector de **QR de identidad** y notificaciones.
- **FE Eng** ‚Äî [ ] No almacenar tokens en `localStorage`; usar cookies HTTPOnly o token storage seguro v√≠a BFF.
- **FE Eng** ‚Äî [ ] Internacionalizaci√≥n b√°sica y accesibilidad AA.
- **FE/OTel** ‚Äî [ ] Telemetr√≠a web (trace/correlation IDs) hasta BFF y Gateway.
- **QA** ‚Äî [ ] E2E Web/Mobile: activaci√≥n ‚Üí login ‚Üí lectura de cat√°logos.

---

## 6) Notificaciones y Documentos (m√≠nimos para PMV)
- **Notifications Dev** ‚Äî [ ] Env√≠o de invitaciones con deep link y expiraci√≥n.
- **Notifications Dev** ‚Äî [ ] Plantillas transaccionales multi-idioma.
- **Documents Dev** ‚Äî [ ] WORM para evidencias m√≠nimas (login cr√≠tico, activaci√≥n, cambios de rol).
- **QA** ‚Äî [ ] Verificaci√≥n de un solo uso del enlace y expiraci√≥n.

---

## 7) Seguridad y Cumplimiento
- **SecOps** ‚Äî [ ] Pol√≠tica anti-enumeraci√≥n (rate-limit + respuestas homog√©neas + opcional proof-of-work).
- **SecOps** ‚Äî [ ] Pol√≠tica de recuperaci√≥n de credenciales AAL2 (sin SMS/email only).
- **SecOps/Compliance** ‚Äî [ ] Modo degradado de Compliance (marcador + SLA ‚â§24 h + auditor√≠a WORM).
- **SecOps** ‚Äî [ ] Pentest de endpoints cr√≠ticos y auditor√≠a de permisos PBAC.
- **Compliance** ‚Äî [ ] Boletines normativos y seeds de cargos firmantes por jurisdicci√≥n.

---

## 8) Observabilidad y M√©tricas
- **Observability** ‚Äî [ ] Dashboards: `auth_latency_p95`, `token_validation_error_rate`, `jwks_refresh_latency_p95`, `revocation_latency_p95`.
- **Observability** ‚Äî [ ] M√©tricas adicionales: `pdp_latency_p95`, `device_attestation_failure_rate`, `dpop_replay_block_rate`.
- **Observability** ‚Äî [ ] Alertas: expiraci√≥n pr√≥xima de claves, `policy_version_skew > 1`, DLQ > 0.
- **Observability** ‚Äî [ ] Trazas de extremo a extremo (FE ‚Üí BFF ‚Üí Gateway ‚Üí Servicio).

---

## 9) CI/CD y Calidad
- **DevEx** ‚Äî [ ] Lint y validaci√≥n **OpenAPI 3.1** (tres servicios) en pipeline.
- **DevEx** ‚Äî [ ] Contract tests BFF‚ÜîGateway‚ÜîServicios.
- **DevEx** ‚Äî [ ] SCA/DAST, secrets scanning, firma de im√°genes, SBOM.
- **DevEx** ‚Äî [ ] Policy-as-Code (OPA) en el pipeline; bundles firmados y verificados.
- **QA** ‚Äî [ ] Pruebas de carga: `auth_latency_p95` y `revocation_latency_p95` dentro de SLO.
- **QA** ‚Äî [ ] Chaos tests m√≠nimos: ca√≠da de Compliance, latencia Redis/JWKS cross-region.

---

## 10) Datos Semilla y Feature Flags
- **Data Eng** ‚Äî [ ] Semillas: tenant demo, condominio, unidades y usuarios admin.
- **Data Eng** ‚Äî [ ] Semillas de roles base y cargos firmantes por jurisdicci√≥n.
- **FE Lead** ‚Äî [ ] Feature flags para habilitar Governance/Reservations en Sprint 2.

---

## 11) Documentaci√≥n
- **Tech Writer** ‚Äî [ ] SAD.md Global actualizado (v1.1).
- **Tech Writer** ‚Äî [ ] Especificaciones t√©cnicas: Identity, Profiles, Tenancy (v1.x).
- **Tech Writer** ‚Äî [ ] OpenAPI 3.1 publicados y enlazados.
- **Tech Writer** ‚Äî [ ] Threat Model Backbone (STRIDE/LINDDUN) actualizado.
- **Tech Writer** ‚Äî [ ] Runbooks: rotaci√≥n JWKS/KMS, revocaci√≥n global, DRP, ca√≠da de Compliance.
- **Tech Writer** ‚Äî [ ] Readme de Frontend/BFF con pr√°cticas de seguridad (PKCE, DPoP, storage).

---

## 12) Go/No-Go y Post-Release
- **SRE/PM** ‚Äî [ ] Checklist Go/No-Go firmado por √°reas (Dev, QA, Sec, Compliance).
- **SRE** ‚Äî [ ] Runbook de rollback y ventanas de mantenimiento.
- **PM/PO** ‚Äî [ ] Plan de soporte post-release y canal de incidencias.

> **Criterio de salida Sprint 1:** Registro‚ÜíActivaci√≥n‚ÜíLogin‚ÜíRevocaci√≥n‚ÜíLectura de cat√°logos funcionando en staging, con observabilidad, seguridad y DRP verificados.

